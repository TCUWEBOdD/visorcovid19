!function(t){var e,i=null,l=null,s=!1,a=75;function o(e,i){this.id=e,this.evt=i,this.target=i.target,this.timeoutID=null,this.cancelled=!1,this.stopped=!1,this.arrow=null;var l=t(this.target).offset();this.target.absLeft=l.left,this.target.absTop=l.top;var s=t("#"+this.id).get(0);if(null==s.payload){var o=parseInt(t("#"+this.id).css("top")),n=parseInt(t("#"+this.id).css("left"));t.isNumeric(o)&&(this.top=o),t.isNumeric(n)&&(this.left=n)}else this.top=s.payload.top,this.left=s.payload.left;s.payload=this,s.onmouseover=function(){null!=this.payload.timeoutID&&clearTimeout(this.payload.timeoutID),this.payload.cancelled=!1,this.payload.timeoutID=null},s.onmouseout=function(){var t=new Object;t.type="mouseout",t.target=this.payload.target,d(t)},1==t("#"+e).data("editable")?t("#"+e+".BubbleDiv .BubbleEditBtn").css({display:"block"}):t("#"+e+".BubbleDiv .BubbleEditBtn").css({display:"none"}),t("#"+s.id+".BubbleDiv .BubbleTitle").width(a+"%")}function n(t,s,a){null!=i&&i.id==t||(null==l||l.id!=t?(i=new o(t,s)).timeoutID=setTimeout(u,null!=a?a:e.openDelay):1==l.cancelled&&(clearTimeout(l.timeoutID),l.cancelled=!1,l.timeoutID=null))}function d(a){if(1!=s&&(null!=i&&(i.stop(),i=null),null!=l))if("mouseout"==a.type)a.target.id==l.target.id&&0==l.cancelled&&(l.evt=a,l.timeoutID=setTimeout(r,e.closeDelay),l.cancelled=!0);else{var o="#"+l.id+" .BubbleContent",n="#"+l.id+" .BubbleContentEditor",d=t(n+" textarea"),u="#"+l.id+" .BubbleTitle",b="#"+l.id+" .BubbleTitleEditor";t(b+" textarea");0!=d.length&&(t(n).remove(),t(o).css({display:"block"}),t(b).remove(),t(u).css({display:"block"})),r(a)}}function u(){null!=l&&l.stop(),l=null,null!=i&&(t(i.target).hasClass("ui-draggable-dragging")?i=null:(l=i,i=null,l.start(),s=!1))}function r(t){null!=l&&(l.stop(t),1==l.stopped&&(l=null))}function b(e){var i=t("#"+e+".BubbleDiv .topLeftArrow"),l=t("#"+e+".BubbleDiv .topRightArrow"),s=null;if(1==("block"==i.css("display"))&&(s=i),1==("block"==l.css("display"))&&(s=l),null!=s){var a=-2;"undefined"!=typeof WebBrowser&&(WebBrowser.isIE()&&8==WebBrowser.getVersion()||WebBrowser.isOpera())&&(a=3);var o=t("#"+e);s.css("top",-(o.height()+a)+"px")}}t.fn.bubble=function(i){return e=t.extend({openDelay:500,closeDelay:2e3,editable:"false"},i),t(document).click(function(e){t(e.target).closest(".BubbleDiv").length||d(e)}),this.each(function(){var i=t(this).data("bubbleid");return null==i&&(i=t('<div class="BubbleDiv" style="display:none">\n  <div class="BubbleShadow">\n    <div class="Bubble">\n      <div class="BubbleHeader">\n        <div class="BubbleTitle"></div>\n        <div class="BubbleCloseBtn"></div>\n        <div class="BubbleEditBtn"></div>\n      </div>\n      <div class="BubbleContent">\n      </div>\n      <div class="bottomLeftArrow"></div>\n      <div class="bottomRightArrow"></div>\n      <div class="topLeftArrow"></div>\n      <div class="topRightArrow"></div>\n    </div>\n  </div>\n</div>\n').appendTo("body").uniqueId().attr("id"),null!=e.ajax?t.getJSON(e.ajax,function(e){t("#"+i+" .BubbleTitle").html(e.title),t("#"+i+" .BubbleContent").html(e.content)}).fail(function(l,s,a){var o="Request failed: "+s+" "+a;t("#"+i+" .BubbleTitle").html(e.ajax),t("#"+i+" .BubbleContent").html(o),console.log(o)}):(t("#"+i+" .BubbleTitle").html(e.title),t("#"+i+" .BubbleContent").html(e.content)),t(this).data("bubbleid",i),e.title=null,e.content=null,e.ajax=null),t("#"+i).data("editable",e.editable),t("#"+i+" .BubbleCloseBtn").click(function(t){d(t)}),t("#"+i+" .BubbleEditBtn").click(function(e){var l="#"+i+" .BubbleContent",a="#"+i+" .BubbleContentEditor",o=t(a+" textarea"),u="#"+i+" .BubbleTitle",r="#"+i+" .BubbleTitleEditor",h=t(r+" textarea"),c=t(l).html(),p=t(u).text();if(0==o.length)t("<div></div>").addClass("BubbleContentEditor").insertAfter(l),t("<textarea></textarea>").val(t.trim(c)).appendTo(a).height(t(l).height()+20),t("<div></div>").addClass("BubbleTitleEditor").insertAfter(u),t("<textarea></textarea>").val(t.trim(p)).appendTo(r).width(t(u).width()).height(t(u).height()),t(l).css({display:"none"}),t(u).css({display:"none"}),b(i);else{c=o.val();t(l).html(c),t(a).remove(),t(l).css({display:"block"});p=h.val();t(u).text(p),t(r).remove(),t(u).css({display:"block"});var v=t("#"+i).get(0);(e=new Object).type="click",e.target=v.payload.target,d(e),s=!0,e.type="mousenter",n(i,e,0)}}),t(this).addClass("ui-bubbleable").mouseenter(function(e){var i=t(this).data("bubbleid");null!=i&&n(i,e)}).mouseout(function(t){d(t)}).mousedown(function(t){d(t)}),t(this)})},o.prototype.start=function(){var e=t("#"+this.id);if(0!=e.length&&"block"!=e.css("display")){e.css("display","block");var i=a;nonTitleWidth=39;var l=t("#"+e.attr("id")+".BubbleDiv .BubbleHeader").width(),s=t("#"+e.attr("id")+".BubbleDiv .BubbleTitle").width();if(l>nonTitleWidth)for(;i>5&&s>l-nonTitleWidth;)i-=5,t("#"+e.attr("id")+".BubbleDiv .BubbleTitle").width(i+"%"),s=t("#"+e.attr("id")+".BubbleDiv .BubbleTitle").width();if(null!=this.top&&null!=this.left)e.css({left:this.left,top:this.top});else{var o=t("#"+e.attr("id")+".BubbleDiv .bottomLeftArrow"),n=t("#"+e.attr("id")+".BubbleDiv .bottomRightArrow"),d=t("#"+e.attr("id")+".BubbleDiv .topLeftArrow"),u=t("#"+e.attr("id")+".BubbleDiv .topRightArrow"),r=!1;this.arrow=o;var h=t("html"),c=this.target.absLeft+this.target.offsetWidth+5;c+e.width()>t(document).width()+h.scrollLeft()&&(c=this.target.absLeft-e.width(),this.arrow=n,r=!0,c<=0&&(c=this.target.absLeft+this.target.offsetWidth+5,this.arrow=o,r=!1));var p=this.target.absTop-e.height();p<=h.scrollTop()&&(p=this.target.absTop+this.target.offsetHeight+5,this.arrow=1==r?u:d),e.css({left:c+"px",top:p+"px"}),null!=this.arrow&&(t(this.arrow).css({display:"block",visibility:"visible"}),b(this.id))}this.evt=null,this.cancelled=!1,this.stopped=!1,this.timeoutID=null}},o.prototype.stop=function(e){null!=this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null),this.cancelled=!1;var i=t("#"+this.id);if(0!=i.length&&"block"==i.css("display")){if(e=e||this.evt,this.evt=null,null!=e)for(var l=e.target;null!=l&&("click"!=e.type||null==l.className||"BubbleCloseBtn"!=l.className);){if(null!=l.parentNode&&l.parentNode.id==this.id)return;l=l.parentNode}null!=this.arrow&&t(this.arrow).css({display:"none",visibility:"hidden"}),i.css("display","none"),this.stopped=!0}}}(jQuery);